UPDATE [COLLSYS.MAPPING.LOAN]
SET
	NOLOAN_FINAL = CONCAT(
		COALESCE(CASE
			WHEN [SOURCE].TYPE IN ('BIC BIRU REGULER') THEN '30'
			WHEN [SOURCE].TYPE IN ('BIC BIRU BIASA/SPESIAL') THEN '31'
			WHEN [SOURCE].TYPE IN ('BIC BIRU REFF MANAJEMEN') THEN '32'
			WHEN [SOURCE].TYPE IN ('BIC BIRU STAFF') THEN '33'
			WHEN [SOURCE].TYPE IN ('BIC EMAS REGULER') THEN '40'
			WHEN [SOURCE].TYPE IN ('BIC EMAS BIASA/SPESIAL') THEN '41'
			WHEN [SOURCE].TYPE IN ('BIC EMAS REFF MANAJEMEN') THEN '42'
			WHEN [SOURCE].TYPE IN ('BIC EMAS STAFF') THEN '43'
			WHEN [SOURCE].TYPE IN ('BIC PLATINUM REGULER') THEN '50'
			WHEN [SOURCE].TYPE IN ('BIC PLATINUM BIASA/SPESIAL') THEN '51'
			WHEN [SOURCE].TYPE IN ('BIC PLATINUM REFF MANAJEMEN') THEN '52'
			WHEN [SOURCE].TYPE IN ('BIC PLATINUM STAFF') THEN '53'
		END, '99'), RIGHT([SOURCE].CUSTNO, 12)
	)
	,NOMORCIF = [SOURCE].[CUSTNO]
	,DIVISI_BSI = 'Hasanah Card'
	,KODECABANG_BSI = 'ID0010001'
	,NAMACABANG_BSI = 'Kantor Pusat'
	,AREA_BSI = 'Kantor Pusat'
	,REGION_BSI = 'Kantor Pusat'
	,FLAG_DATA = CASE WHEN [SOURCE].[PB] = 'Z' THEN 'WO' ELSE 'ONBS' END
	,UPDATE_STATUS = 'LOCKED'
FROM [COLLSYS.MAPPING.LOAN] [TARGET]
LEFT JOIN [NEW_BSI_STORAGE].[dbo].[BNIS.HASANAH_CARD.2018-12-30] [SOURCE]
	ON [TARGET].[NOLOAN] = [SOURCE].[CARDNO_REAL]
WHERE [TARGET].[NOLOAN] = [TARGET].[NOLOAN_FINAL]
AND [TARGET].[NOMORCIF] IS NULL
AND [SOURCE].[CARDNO] IS NOT NULL;
